serviceMaps:
  serviceName: evidence-services
  mappings:
    - version: 1.0
      description: Persists artifact details in tables
      fromTopic: save-artifact-application
      isTransaction: true
      queryMaps:

        - query: INSERT INTO dristi_evidence_artifact(id, tenantId, artifactNumber, evidenceNumber, externalRefNumber, caseId, application, hearing, orders, mediaType, artifactType, sourceID, sourceName, createdDate, isActive, status, description, artifactDetails, additionalDetails, createdBy, lastModifiedBy, createdTime, lastModifiedTime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
          basePath: artifacts.*
          jsonMaps:
            - jsonPath: $.artifacts.*.id
            - jsonPath: $.artifacts.*.tenantId
            - jsonPath: $.artifacts.*.artifactNumber
            - jsonPath: $.artifacts.*.evidenceNumber
            - jsonPath: $.artifacts.*.externalRefNumber
            - jsonPath: $.artifacts.*.caseId
            - jsonPath: $.artifacts.*.application
            - jsonPath: $.artifacts.*.hearing
            - jsonPath: $.artifacts.*.order
            - jsonPath: $.artifacts.*.mediaType
            - jsonPath: $.artifacts.*.artifactType
            - jsonPath: $.artifacts.*.sourceID
            - jsonPath: $.artifacts.*.sourceName
            - jsonPath: $.artifacts.*.createdDate
            - jsonPath: $.artifacts.*.isActive
            - jsonPath: $.artifacts.*.status
            - jsonPath: $.artifacts.*.description
            - jsonPath: $.artifacts.*.artifactDetails
              type: JSON
              dbType: JSONB
            - jsonPath: $.artifacts.*.additionalDetails
              type: JSON
              dbType: JSONB
            - jsonPath: $.artifacts.*.auditdetails.createdBy
            - jsonPath: $.artifacts.*.auditdetails.lastModifiedBy
            - jsonPath: $.artifacts.*.auditdetails.createdTime
            - jsonPath: $.artifacts.*.auditdetails.lastModifiedTime

        - query: INSERT INTO dristi_evidence_document(id,fileStore,documentUid,documentType,artifactId,additionalDetails) VALUES (?,?, ?, ?, ?,?);
          basePath: artifacts.*.file
          jsonMaps:
            - jsonPath: $.artifacts.*.file.id
            - jsonPath: $.artifacts.*.file.fileStore
            - jsonPath: $.artifacts.*.file.documentUid
            - jsonPath: $.artifacts.*.file.documentType
            - jsonPath: $.artifacts.*.id
            - jsonPath: $.artifacts.*.file.additionalDetails
              type: JSON
              dbType: JSONB

        - query: INSERT INTO dristi_evidence_comment(id, tenantId, artifactId, individualId, comment, isActive, additionalDetails, createdBy, lastModifiedBy, createdTime, lastModifiedTime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
          basePath: artifacts.*.comments.*
          jsonMaps:
            - jsonPath: $.artifacts.*.comments.*.id
            - jsonPath: $.artifacts.*.comments.*.tenantId
            - jsonPath: $.artifacts[*][?({id} in @.comments[*].id)].id
            - jsonPath: $.artifacts.*.comments.*.individualId
            - jsonPath: $.artifacts.*.comments.*.comment
            - jsonPath: $.artifacts.*.comments.*.isActive
            - jsonPath: $.artifacts.*.comments.*.additionalDetails
              type: JSON
              dbType: JSONB
            - jsonPath: $.artifacts.*.comments.*.auditdetails.createdBy
            - jsonPath: $.artifacts.*.comments.*.auditdetails.lastModifiedBy
            - jsonPath: $.artifacts.*.comments.*.auditdetails.createdTime
            - jsonPath: $.artifacts.*.comments.*.auditdetails.lastModifiedTime

    - version: 1.0
      description: Update artifact details in tables
      fromTopic: update-artifact-application
      isTransaction: true
      queryMaps:
        - query: INSERT INTO dristi_evidence_artifact (id, tenantId, artifactNumber, evidenceNumber, externalRefNumber, caseId, application, hearing, orders, mediaType, artifactType, sourceID, sourceName, createdDate, isActive, status, description, artifactDetails, additionalDetails, createdBy, lastModifiedBy, createdTime, lastModifiedTime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ON CONFLICT (id) DO UPDATE SET tenantId = EXCLUDED.tenantId, artifactNumber = EXCLUDED.artifactNumber, evidenceNumber = EXCLUDED.evidenceNumber, externalRefNumber = EXCLUDED.externalRefNumber, caseId = EXCLUDED.caseId, application = EXCLUDED.application, hearing = EXCLUDED.hearing, orders = EXCLUDED.orders, mediaType = EXCLUDED.mediaType, artifactType = EXCLUDED.artifactType, sourceID = EXCLUDED.sourceID, sourceName = EXCLUDED.sourceName, createdDate = EXCLUDED.createdDate, isActive = EXCLUDED.isActive, status = EXCLUDED.status, description = EXCLUDED.description, artifactDetails = EXCLUDED.artifactDetails, additionalDetails = EXCLUDED.additionalDetails, createdBy = EXCLUDED.createdBy, lastModifiedBy = EXCLUDED.lastModifiedBy, createdTime = EXCLUDED.createdTime, lastModifiedTime = EXCLUDED.lastModifiedTime;
          basePath: artifacts.*
          jsonMaps:
            - jsonPath: $.artifacts.*.id
            - jsonPath: $.artifacts.*.tenantId
            - jsonPath: $.artifacts.*.artifactNumber
            - jsonPath: $.artifacts.*.evidenceNumber
            - jsonPath: $.artifacts.*.externalRefNumber
            - jsonPath: $.artifacts.*.caseId
            - jsonPath: $.artifacts.*.application
            - jsonPath: $.artifacts.*.hearing
            - jsonPath: $.artifacts.*.order
            - jsonPath: $.artifacts.*.mediaType
            - jsonPath: $.artifacts.*.artifactType
            - jsonPath: $.artifacts.*.sourceID
            - jsonPath: $.artifacts.*.sourceName
            - jsonPath: $.artifacts.*.createdDate
            - jsonPath: $.artifacts.*.isActive
            - jsonPath: $.artifacts.*.status
            - jsonPath: $.artifacts.*.description
            - jsonPath: $.artifacts.*.artifactDetails
              type: JSON
              dbType: JSONB
            - jsonPath: $.artifacts.*.additionalDetails
              type: JSON
              dbType: JSONB
            - jsonPath: $.artifacts.*.auditdetails.createdBy
            - jsonPath: $.artifacts.*.auditdetails.lastModifiedBy
            - jsonPath: $.artifacts.*.auditdetails.createdTime
            - jsonPath: $.artifacts.*.auditdetails.lastModifiedTime

        - query: INSERT INTO dristi_evidence_comment (id, tenantId, artifactId, individualId, comment, isActive, additionalDetails, createdBy, lastModifiedBy, createdTime, lastModifiedTime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ON CONFLICT (id) DO UPDATE SET tenantId = EXCLUDED.tenantId, artifactId = EXCLUDED.artifactId, individualId = EXCLUDED.individualId, comment = EXCLUDED.comment, isActive = EXCLUDED.isActive, additionalDetails = EXCLUDED.additionalDetails, createdBy = EXCLUDED.createdBy, lastModifiedBy = EXCLUDED.lastModifiedBy, createdTime = EXCLUDED.createdTime, lastModifiedTime = EXCLUDED.lastModifiedTime;
          basePath: artifacts.*.comments.*
          jsonMaps:
            - jsonPath: $.artifacts.*.comments.*.id
            - jsonPath: $.artifacts.*.comments.*.tenantId
            - jsonPath: $.artifacts[*][?({id} in @.comments[*].id)].id
            - jsonPath: $.artifacts.*.comments.*.individualId
            - jsonPath: $.artifacts.*.comments.*.comment
            - jsonPath: $.artifacts.*.comments.*.isActive
            - jsonPath: $.artifacts.*.comments.*.additionalDetails
              type: JSON
              dbType: JSONB
            - jsonPath: $.artifacts.*.comments.*.auditdetails.createdBy
            - jsonPath: $.artifacts.*.comments.*.auditdetails.lastModifiedBy
            - jsonPath: $.artifacts.*.comments.*.auditdetails.createdTime
            - jsonPath: $.artifacts.*.comments.*.auditdetails.lastModifiedTime



